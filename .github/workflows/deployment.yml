name: Deploy Assets to Zone

on:
  workflow_dispatch:
    inputs:
      branch_name:
        description: 'Branch name containing the asssets to test'
        required: true
      private_key:
        description: 'Private key to use to sign the deployment'
        required: true
      public_key:
        description: 'Public key to use to sign the deployment'
        required: true

jobs:
  deploy-assets:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2
        with:
          ref: ${{ github.event.inputs.branch_name }}

      - name: Prepare Deployment
        run: |
          yarn run prepare "${{ github.event.inputs.branch_name }}" https://peer.decentraland.zone > script_output.txt
          DEPLOY_COMMAND=$(cat script_output.txt | grep 'COMMAND -' | sed 's/^.*COMMAND - //')
          echo "DEPLOY_COMMAND=$DEPLOY_COMMAND" >> $GITHUB_ENV
          echo "Deployment command: ${{ env.DEPLOY_COMMAND }}"